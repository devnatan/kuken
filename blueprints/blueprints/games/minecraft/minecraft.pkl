/// # Minecraft: Java Edition Blueprint
///
/// KÃ¼ken blueprint for deploying Minecraft Java Edition servers using the [itzg/minecraft-server](https://github.com/itzg/docker-minecraft-server) Docker image.
module io.kuken.minecraft.Minecraft

amends "https://kuken.io/blueprints/reference/v1/Reference.pkl"

name = "Minecraft: Java Edition"
version = "1.0.0"
url = "https://kuken.io"

assets {
  icon = "https://kuken.io/blueprints/icons/minecraft-java-edition.png"
}

// ============================================================================
// INPUT DEFINITIONS
// ============================================================================

/// Docker image tag/version for the Minecraft server container.
local JavaVersion =
  selectInput(
    "java-version",
    "Java Version",
    List("stable", "java25", "java21", "java17", "java11", "java8"),
  )

/// Minecraft version to run on the server.
/// Use `"LATEST"` for the newest release, specific versions like `"1.20.4"`, or `"SNAPSHOT"` for testing builds.
local GameVersion = textInput("game-version", "Minecraft Version")

/// Server type/distribution to run.
/// Options include `"VANILLA"` (default), `"PAPER"` (optimized), `"SPIGOT"`, `"FORGE"`, or `"FABRIC"`.
local ServerType = textInput("server-type", "Server Type")

// ============================================================================
// USER INPUTS
// ============================================================================

inputs {
  JavaVersion
  GameVersion
  ServerType
  MaxMemory
  RconPassword
  RconPort
}

// ============================================================================
// BUILD CONFIGURATION
// ============================================================================

build {
  docker {
    image = "itzg/minecraft-server:\(JavaVersion)"
  }

  environmentVariables {
    // Automatically accept the Minecraft EULA, required for server startup.
    new { name = "EULA"; value = true }
    new { name = "ENABLE_RCON"; value = true }
    new { name = "TYPE"; value = ServerType }
    new { name = "VERSION"; value = GameVersion }
    new { name = "MEMORY"; value = MaxMemory }
    new { name = "RCON_PASSWORD"; value = RconPassword }
    new { name = "RCON_PORT"; value = RconPort }
  }
}

instance {
  startup = "java Xms128M -jar server.jar"
}
