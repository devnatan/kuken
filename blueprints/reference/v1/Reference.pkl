@ModuleInfo { minPklVersion = "0.30.2" }
module io.kuken.Blueprint

name: String
version: String
url: Source

assets: Assets?
inputs: InputDefinitions
build: Build
refs: Refs

class Assets {
  icon: Source
}

class Refs {
  port = "port"
}

abstract class Property

typealias TransformedProperty =
  String | Input("input:\(this.name)") | EnvironmentVariable("\(this.name)=\(value)")

typealias InputDefinitions = Listing<Input>

abstract class Input extends Property {
  abstract name: String
  abstract label: String

  hidden type: String
}

class TextInput extends Input {
  abstract name: String
  abstract label: String
  hidden type = "text"
}

class PasswordInput extends Input {
  abstract name: String
  abstract label: String
  hidden type = "password"
}

class PortInput extends Input {
  abstract name: String
  abstract label: String
  hidden type = "port"

  default: UInt16
}

class Build {
  docker: Docker
  environmentVariables: EnvironmentVariablesDefinition
}

typealias EnvironmentVariablesDefinition = Listing<EnvironmentVariable>

const function env(_name: String, _value: EnvironmentVariableValue): EnvironmentVariable = new {
  name = _name
  value = _value
}

typealias EnvironmentVariableValue = String | Number | Boolean | Input | DataSize

class EnvironmentVariable extends Property {
  name: String
  value: EnvironmentVariableValue
}

class Docker {
  image: TransformedProperty
}

typealias Source = String
